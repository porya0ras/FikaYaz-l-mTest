angular.module("ui.multiselect",[]).factory("optionParser",["$parse",function(n){var t=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(i){var r=i.match(t);if(!r)throw new Error("Expected typeahead specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+i+"'.");return{itemName:r[3],source:n(r[4]),viewMapper:n(r[2]||r[1]),modelMapper:n(r[1])}}}}]).directive("multiselect",["$parse","$document","$compile","optionParser",function(n,t,i,r){return{restrict:"E",require:"ngModel",link:function(t,u,f,e){function v(){var n,i,r;if(o.items.length=0,n=s.source(t),angular.isDefined(n))for(i=0;i<n.length;i++)r={},r[s.itemName]=n[i],o.items.push({label:s.viewMapper(r),model:n[i],checked:!1})}function w(){if(b(e.$modelValue))return o.header="Select";if(h)o.header=e.$modelValue.length+" selected";else{var n={};n[s.itemName]=e.$modelValue;o.header=s.viewMapper(n)}}function b(n){if(!n)return!0;if(n.length&&n.length>0)return!1;for(var t in n)if(n[t])return!1;return!0}function k(n){n.checked?o.uncheckAll():(o.uncheckAll(),n.checked=!n.checked);c(!1)}function d(n){n.checked=!n.checked;c(!0)}function c(n){var t;n?(t=[],angular.forEach(o.items,function(n){n.checked&&t.push(n.model)})):angular.forEach(o.items,function(n){if(n.checked)return t=n.model,!1});e.$setViewValue(t)}function g(n){angular.isArray(n)?angular.forEach(n,function(n){angular.forEach(o.items,function(t){angular.equals(t.model,n)&&(t.checked=!0)})}):angular.forEach(o.items,function(t){if(angular.equals(t.model,n))return t.checked=!0,!1})}var y=f.options,s=r.parse(y),h=f.multiple?!0:!1,l=!1,o=t.$new(),p=f.change||anguler.noop,a;o.items=[];o.header="Select";o.multiple=h;o.disabled=!1;t.$on("$destroy",function(){o.$destroy()});a=angular.element("<multiselect-popup><\/multiselect-popup>");(f.required||f.ngRequired)&&(l=!0);f.$observe("required",function(n){l=n});o.$watch(function(){return n(f.disabled)(t)},function(n){o.disabled=n});o.$watch(function(){return n(f.multiple)(t)},function(n){h=n||!1});o.$watch(function(){return s.source(t)},function(n){angular.isDefined(n)&&v()},!0);o.$watch(function(){return e.$modelValue},function(n){angular.isDefined(n)&&(g(n),o.$eval(p));w();e.$setValidity("required",o.valid())},!0);v();u.append(i(a)(o));o.valid=function(){if(!l)return!0;var n=e.$modelValue;return angular.isArray(n)&&n.length>0||!angular.isArray(n)&&n!=null};o.checkAll=function(){h&&(angular.forEach(o.items,function(n){n.checked=!0}),c(!0))};o.uncheckAll=function(){angular.forEach(o.items,function(n){n.checked=!1});c(!0)};o.select=function(n){h===!1?(k(n),o.toggleSelect()):d(n)}}}}]).directive("multiselectPopup",["$document",function(n){return{restrict:"E",scope:!1,replace:!0,templateUrl:"lib/multiselect/multiselect.tmpl.html",link:function(t,i){function r(f){u(f.target,i.find(f.target.tagName))||(i.removeClass("open"),n.unbind("click",r),t.$apply())}t.isVisible=!1;t.toggleSelect=function(){i.hasClass("open")?(i.removeClass("open"),n.unbind("click",r)):(i.addClass("open"),n.bind("click",r),t.focus())};t.focus=function(){var n=i.find("input")[0];n.focus()};var u=function(n,t){for(var i=0;i<t.length;i++)if(n==t[i])return!0;return!1}}}}]);